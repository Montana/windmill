<div class="container">
  <h1>Configuration group: <%= @cg.name %></h1>

  <h2>Configuration files in this group (<%= @cg.configurations.count %>)</h2>
  <form id="configurationList" action="<%= "/configuration-groups/#{@cg.id}" %>" method="post">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Version</th>
          <th>Assignment Count</th>
          <th>Endpoint Count</th>
          <th>Default Config</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @cg.configurations.each do |config| %>
          <tr>
            <td><%= config.name %></td>
            <td><%= config.version %></td>
            <td><%= config.assigned_endpoints.count %></td>
            <td><%= config.configured_endpoints.count %></td>
            <td><input type="radio" name="default_config" value="<%= config.id %>" <% if @default_config == config %>checked="checked"<% end %>/></td>
            <td>
              <% if @cg.canary_in_progress? %>
                <% if @cg.canary_config == config %>
                  <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-edit"> Canary</i></button>
                <% else %>
                  <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#myModal" disabled>Canary</button>
                <% end %>
              <% else %>
                <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-play"> Canary</i></button>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <button type="submit" class="btn btn-default">Save</button>
  </form>

  <div class="modal fade" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Reassign endpoints</h4>
        </div>
        <div class="modal-body">
          <div class="media">
            <div class="media-left media-top">
              <img class="media-object" src="/murica.jpg" />
            </div>
            <div class="media-body">
              <p>You are about to assign a different configuration to some of the
              osquery endpoints. These endpoints will receive the new configuration
              when they check in for a configuration update. Are you sure you
              want to do this?</p>
            </div>
          </div>
        </div>
        <div class="center-block">

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="beer">Hold my beer</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <a href="<%= "/configuration-groups/#{@cg.id}/configurations/new" %>">Add new configuration</a>



  <h2>Endpoints in this group (<%= @cg.endpoints.count %>)</h2>

  <table class="table">
    <thead>
      <tr>
        <th>Identifier</th>
        <th>Osquery version</th>
        <th>Config refresh count</th>
        <th>Last ip address</th>
        <th>Last config refresh</th>
        <th>Assigned Configuration</th>
      </tr>
    </thead>
    <tbody>
      <% @cg.endpoints.each do |endpoint| %>
        <tr>
          <td><%= endpoint.identifier %></td>
          <td><%= endpoint.last_version %></td>
          <td><%= endpoint.config_count %></td>
          <td><%= endpoint.last_ip %></td>
          <td><%= endpoint.last_config_time %></td>
          <td><%= endpoint.assigned_config.name %></td>
      <% end %>
    </tbody>
  </table>
</div>
